---
title: 数据库索引
date: 2021-07-28 23:08:51
tags:
- 数据库
---

数据库索引的本质是一种数据结构。

<!-- more -->

索引是定义在**数据表**的基础之上的，包括某个表中一列或若干列值，以及指向相对应数据页的逻辑指针。

建立索引的意义，在于能够通过缩小一张表中需要查询的记录/行的数目，来加快搜索所需数据的速度。  
相当于图书的目录，可根据目录的页码快速找到所需内容。

一个好的数据库表设计，从一开始就应考虑添加索引。  
因为索引数据的存储是有序的，通过查询索引数据去找东西，不需要遍历所有记录。  
最极端情况也就是：索引查询的效率等于二分法查询，趋近于 `log2(N)`。


# 优缺点

索引最大的优点，是能够大大加快数据的检索速度。这是创建索引的最主要原因。
* 通过创建唯一性索引，可保证数据库表中每一行数据的唯一性
* 可加速表和表之间的连接，特别是在实现数据的参考完整性方面特别有意义

对应的，索引的缺点也不少：
* 占用物理空间，聚簇索引的空间更大
* 创建索引和维护索引需要耗费时间，随着数据量增加而增加
* 对表中的数据进行增加、删除和修改时，索引也要动态维护：降低维护速度

因此以下情况不适合建立索引：
* 表中数据太少
* 经常插入、删除、修改的表
* 表数据重复且分布平均的表字段
* ...


# 设计原则

* 对于经常查询的字段，建议创建索引
* 索引不是越多越好：表如果有大量索引，不仅占用磁盘空间，而且影响 insert，delete，update 等语句的性能
    * 所以：避免对经常更新的表进行过多的索引，因为表中数据被更改的同时，索引也会进行调整和更新，十分消耗系统资源
* 数据量小的表建议不要创建索引：此时索引不仅起不到明显的优化效果，对于索引结构的维护反而消耗系统资源
* 不要在区分度低的字段建立索引：如性别字段，只有“男”“女”，建索引完全起不到优化效果
* 当唯一性是某字段本身的特征时，指定唯一索引能提高查询字段
* 在频繁进行排列分组（group by / order by）的列上建立索引，如待排序有多个，可在这些列上建立组合索引


# 实现

采用的数据结构：B-Tree

为什么不使用 Hash 搜索呢？

Hash 的查询、插入、修改、删除的平均时间为 `O(1)`，而树的对应复杂度则为 `O(log(n))`。  
对于单行查询的需求，Hash 索引更快；但 SQL 的应用场景多为排序（order by）、分组（group by）和比较大小等操作，如果仍然使用 Hash，时间会退化为 `O(n)`。  
所以根据 SQL 的需求，索引一般设计为树的数据结构。
